<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Movie Review API Tester</title>
  <style>
    body{font-family:Arial, sans-serif;background:#f5f5f5;padding:20px;}
    .section{background:white;padding:20px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    button{background:#667eea;color:white;border:none;padding:10px 16px;border-radius:5px;margin:4px;cursor:pointer;}
    button:hover{background:#5568d3;}
    pre{background:#f0f0f0;padding:10px;border-radius:5px;max-height:300px;overflow:auto;}
  </style>
</head>
<body>
  <h1>üé¨ Movie Review API Tester</h1>
  <p>Gunakan tombol di bawah untuk mengetes endpoint backend kamu.</p>

  <div class="section">
    <h2>üîê Authentication</h2>
    <input id="user" placeholder="Username"><br>
    <input id="pass" placeholder="Password" type="password"><br>
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
    <button onclick="profile()">Get Profile</button>
    <button onclick="logout()">Logout</button>
    <pre id="authResult"></pre>
  </div>

  <div class="section">
    <h2>üé• Movies</h2>
    <button onclick="getMovies()">Get All Movies</button>
    <button onclick="getMovie(1)">Get Movie #1</button>
    <button onclick="topRated()">Get Top Rated</button>
    <pre id="moviesResult"></pre>
  </div>

  <script>
    const API = "http://localhost/movie-review/api";
    let token = localStorage.getItem("token");

    async function call(endpoint, method="GET", body=null, auth=false){
      const headers = {};
      if(auth && token) headers["Authorization"] = "Bearer " + token;
      if(body) headers["Content-Type"] = "application/json";
      const res = await fetch(API + endpoint, {
        method, headers,
        body: body ? JSON.stringify(body) : null
      });
      return res.json();
    }

    async function register(){
      const data = await call("/auth/register.php","POST",{
        username: user.value, password: pass.value, email: user.value+"@mail.com"
      });
      authResult.textContent = JSON.stringify(data,null,2);
    }

    async function login(){
      const data = await call("/auth/login.php","POST",{username:user.value,password:pass.value});
      if(data.success && data.data?.token){
        token = data.data.token;
        localStorage.setItem("token",token);
      }
      authResult.textContent = JSON.stringify(data,null,2);
    }

    async function profile(){
      const data = await call("/auth/profile.php","GET",null,true);
      authResult.textContent = JSON.stringify(data,null,2);
    }

    async function logout(){
      const data = await call("/auth/logout.php","POST",null,true);
      localStorage.removeItem("token"); token=null;
      authResult.textContent = JSON.stringify(data,null,2);
    }

    async function getMovies(){
      const data = await call("/movies/get_all.php");
      moviesResult.textContent = JSON.stringify(data,null,2);
    }

    async function getMovie(id){
      const data = await call(`/movies/get_detail.php?id=${id}`);
      moviesResult.textContent = JSON.stringify(data,null,2);
    }

    async function topRated(){
      const data = await call("/movies/top_rated.php");
      moviesResult.textContent = JSON.stringify(data,null,2);
    }
  </script>
</body>
</html>
